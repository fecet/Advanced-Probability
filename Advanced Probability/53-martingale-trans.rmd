## Martingale Transformation

This section contains results for discrete time.

### Doob's decomposition

::: {.definition  name=""}

A process $\left\{ X_{t} \right\}_{t \in \mathbb{N}}$ is said to be $\mathbb{F}$-predictable if $X_0 \in \mathcal{F}_0$ and $X_{n+1}\in \mathcal{F}_{n}$ for every $n \in \mathbb{N}$.

:::

::: {.theorem #doob-decomposition name="Doob's decomposition theorem"}

Let $X$ be integrable and adapted, then it can be decomposed as
$$
X_n=X_0+M_n+A_n
$$
where $M$ is a martingale while $A$ is a martingale, both starting at $0$.

:::

### Integration in discrete time

Suppose $M$ and $F$ are real-valued stochastic process and define:
$$
X_n=M_0F_0+\sum_{n\ge 1}^{}(M_n-M_{n-1})F_n
$$
that is the integral of $F \text{ w.r.t }$ to $M$ and write $X=\int FdM$


::: {.theorem  name="You can't beat the system"}

Let $F$ be a bounded predictable process, $X=\int FdM$ is a supermartingale if so is $M$ and $F\ge 0$, it's a martingale if so is $M$.


:::


::: {.proposition  name=""}

Suppose $S$ and $T$ are stopping time of $\mathbb{F}$ with $S\le T$, for any $V \in \mathcal{F}_{S}$, then
$$
V \bm{1}_{(S,T]},V \bm{1}_{(s,\infty]},\bm{1}_{(S,T]},\bm{1}_{[0,S]}
$$
are all predictable. 

:::

:::: {.proof}

Let $F=V \bm{1}_{(S,\infty]}$, note
$$
F_{n+1}=V \bm{1}_{(s,\infty]}(n+1)=V \bm{1}_{S\le n}\in \mathcal{F}_{n}
$$
thus $V \bm{1}_{(S,\infty]}$ is predictable and $V \bm{1}_{(S,T]}$ is predictable by noting it is difference between $V \bm{1}_{(T,\infty]}$ and $V \bm{1}_{(S,\infty]}$. Finally, let $V=1$ yields the other two.

::::

Let $F=\bm{1}_{[0,T]}$ in preceding theorem, we have the stopped supermartingale $\left\{ X^{T}_{n}=X_{\tau \land  n} \right\}$, is a supermartingale if so is $X$. 

### Doob's Optional-Stopping Theorem

Here the time set is still $\mathbb{N}$.

::: {.theorem #doob-stopping name=""}

Let $M$ adapted to $\mathbb{F}$, TFAE:

a. $M$ is a submartingale.

b. For bounded stopping time $\sigma\le \tau$,
$$
\mathop{{}\mathbb{E}}_{\sigma}(M_{\tau}-M_{\sigma})\ge 0   
$$
and both are integrable.

c. 
For bounded stopping time $\sigma\le \tau$,
$$
\mathop{{}\mathbb{E}}_{}(M_{\tau}-M_{\sigma})\ge 0   
$$
and both are integrable.

:::




::: {.theorem  name=""}

Let $\tau$ be a stopping time, let $X$ be a supermartingale. Then $X_\tau$ is integral and $\mathop{{}\mathbb{E}}_{}X_{\tau}\le \mathop{{}\mathbb{E}}_{}X_0$ if one of flowing holds:

1.  $\tau$ is bounded.
2.  $X$ is bounded and $\tau$ is $a.s.$ bounded.
3.  $\mathop{{}\mathbb{E}}_{}\tau<\infty$ and $\left| X_n-X_{n-1} \right|$ is bounded for any $n$.

:::

Apply this to both $X$ and $-X$, we have $\mathop{{}\mathbb{E}}_{}X_{\tau}=\mathop{{}\mathbb{E}}_{}X_0$ and $X$ is integral under the same situations.


::: {.corollary  name=""}

Suppose $X$ is a martingale with increments $X_{n}-X_{n-1}$ is bounded and $C$ is bounded previsible processes, $\mathop{{}\mathbb{E}}_{}\tau<\infty$, then
$$
\mathop{{}\mathbb{E}}_{}(CX)_{\tau}=0
$$

:::

::: {.corollary  name=""}

If $X\ge 0$ is supermartingale and $\tau$ is $a.s.$ finite, then $\mathop{{}\mathbb{E}}_{}X_{\tau}\le \mathop{{}\mathbb{E}}_{}X_0$.

:::

:::: {.proof}
$$
\mathop{{}\mathbb{E}}_{}X_{\tau}=\mathop{{}\mathbb{E}}_{}\liminf_n X_{\tau \land n}\le \liminf_n \mathop{{}\mathbb{E}}_{}X_{\tau \land n} \le \mathop{{}\mathbb{E}}_{}X_0
$$

::::

### Maxima and Minimum

Suppose $X$ is a discrete marginal adapted to $\mathbb{F}$, for $n \in \mathbb{N}$, define
$$
M_n=\max _{k\le n}X_{k}, m_n=\min _{k\le n} X_{k}   
$$

::: {.theorem #maxima-minimum name=""}

Suppose $X$ is a submartingale, then for $b>0$,
$$
\begin{aligned}
    b\mathop{{}\mathbb{P}}\left\{ M_n\ge b \right\}&\le \mathop{{}\mathbb{E}}_{}X_n^{+}\\
    b \mathop{{}\mathbb{P}}\left\{ m_n\le -b \right\}&\le \mathop{{}\mathbb{E}}_{}X_n^{+}-\mathop{{}\mathbb{E}}_{}X_0
\end{aligned}
$$

:::


:::: {.proof}

Let $\tau$ and $\sigma$ be the stopping time $\text{ s.t. }$
$$
\tau=\inf_{\mathbb{N}} \left\{ X_n\ge b \right\},\sigma=\inf _{\mathbb{N}}\left\{ X_n\le -b \right\}
$$
then $\left\{ M_n\ge b \right\}=\left\{ T\le n \right\}$, "untake" expectation each side, we have
$$
b \bm{1}_{\tau\le n}\le X_{\tau \land n} \bm{1}_{\tau\le n} \le \mathop{{}\mathbb{E}}_{\tau \land n} X_n \bm{1}_{\tau \le  n} 
$$
for the minimum, note
$$
M_{\sigma \land n} = M_{\sigma}\bm{1}_{\sigma\le n}+M_{n}\bm{1}_{\sigma>n}\le -b \bm{1}_{\sigma\le n}+M_n \bm{1}_{\sigma >n}    
$$

::::

Recall remarks \@ref(def:martingale), we know that $\left| M \right|^{p}$ is submartingale for $p\ge 1$ provided $M$ is martingale and in $L^p$. Then apply preceding theorem to $\left| M \right|^{p}$ yields the generalization of theorem \@ref(thm:kolmogorov-inequality):

::: {.theorem #doob-kolmogorov-inequality name="Doob-Kolmogorov Inequality"}

Let $M$ be a martingale in $L^p$ for $p\ge 1$, then for $b>0$,
$$
b^{p}\mathop{{}\mathbb{P}}\left\{ \max _{k\le n} \left| M_{k} \right|>b \right\}\le \mathop{{}\mathbb{E}}_{}\left| M_n \right|^{p}
$$

:::

For submartingale $M$, combine these two statement yields:
$$
b\mathop{{}\mathbb{P}}\left\{ \max_{k\le n} \left| M_{k} \right| >b \right\}\le 2 \mathop{{}\mathbb{E}}_{} M_n^{+}-\mathop{{}\mathbb{E}}_{}M_0\le 3 \max_{k\le n} \left| M_{k} \right|
$$







### Awaiting the almost inevitable

::: {.lemma  name=""}

Suppose that $\tau$ is a stopping time $s.t.$ for some $N\in \mathbb{N}$ and $\varepsilon>0$, we have $\forall n \in \mathbb{N}$:
$$
\mathop{{}\mathbb{P}}_{\mathcal{F}_n}\left\{ \tau\le n+N \right\}>\varepsilon
$$
$a.s.$, then $\mathop{{}\mathbb{E}}_{}\tau<\infty$.


:::


